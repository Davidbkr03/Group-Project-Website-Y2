@page "/"
@rendermode InteractiveServer

<div class="main-page-wrapper">
    <div class="main-page @(_showPanel ? "main-page-blurred" : "")">
        <h1>Home Feed</h1>
        <button @onclick="TogglePanel">Show Panel</button>
        @foreach (var post in posts)
        {
            <Post Content="@post.Content" />
        }
    </div>

    @if (_showPanel)
    {
        <div class="component-container">
            <Component onClose="TogglePanelAndLoadPosts" />
        </div>
    }
</div>

@foreach (var post in posts)
{
    <Post Content="@post.Content" />
}

@code {
    private bool _showPanel = false;
    List<Post> posts = new List<Post>();
    String postContent = "";

    protected override async Task OnInitializedAsync()
    {
        await LoadPostsAsync();
    }

    private async Task LoadPostsAsync()
    {
        var postFiles = Directory.GetFiles("posts", "*.json");
        posts.Clear(); // Wipe the posts list before adding new values
        foreach (var file in postFiles)
        {
            String postContent = await File.ReadAllTextAsync(file);
            var post = new Post { Content = postContent }; // Set the Content property of the Post object
            posts.Add(post);
            Console.WriteLine("Testing:" + postContent);
        }
    }

    private async Task TogglePanelAndLoadPosts()
    {
        TogglePanel();
        await LoadPostsAsync();
    }

    private void TogglePanel()
    {
        _showPanel = !_showPanel;
    }
}
